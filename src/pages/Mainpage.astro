<script>
  import Konva from "konva";

  function drawDeck() {
    const input = document.getElementById('inputData').value;
    const commands = input.split(',').map(item => item.trim());

    const container = document.getElementById('container')
    const containerWidth = container.clientWidth
    const containerHeight = container.clientHeight
    
    // Initialize Konva stage and layer
    const stage = new Konva.Stage({
        container: 'container',
        width: containerWidth,
        height: containerHeight
    });

    const layer = new Konva.Layer();
    stage.add(layer);

    // Set the background color of the stage
    // const backgroundRect = new Konva.Rect({
    //     width: stage.width(),
    //     height: stage.height(),
    //     fill: 'red' // Background color
    // });
    // layer.add(backgroundRect);

    let x = 0;
    let y = 0;
    let angle = 0;

    // Create a line starting from (0, 0)
    const line = new Konva.Line({
        points: [0,0],
        stroke: 'black',
        strokeWidth: 4
    });
    layer.add(line);

    for (let i = 0; i < commands.length; i++) {
        const command = parseFloat(commands[i]);
        if (isNaN(command)) {
            continue; // Skip invalid commands
        }

        if (i % 2 === 0) {
            // Length command
            const length = command;
            const radians = (angle - 90) * Math.PI / 180;

            const newX = x + length * Math.cos(radians);
            const newY = y + length * Math.sin(radians);

            line.points([...line.points(), newX, newY]);

            x = newX;
            y = newY;
        } else {
            // Angle command
            angle = command;
        }
    }

    layer.batchDraw();
}


  const button = document.getElementById("draw-button");

  button.addEventListener("click", () => {
    drawDeck();
  });

  const form = document.getElementById("form")
  form.addEventListener('submit', (e) => {
    e.preventDefault()
    drawDeck()
  })
</script>

<style>
  canvas {
    border: 2px solid black;
  }
</style>

<div id="container" class="bg-blue-300 w-full h-full" />
